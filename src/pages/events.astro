---
import { getCollection, render } from 'astro:content';
import BaseHead from '../components/BaseHead.astro';
import Header from '../components/Header.astro';
import Footer from '../components/Footer.astro';
import { SITE_TITLE } from '../consts';

const events = (await getCollection('events')).sort((a, b) => {
    return b.data.date.localeCompare(a.data.date);
});

// Render all events
const renderedEvents = await Promise.all(
    events.map(async (event) => {
        const { Content } = await render(event);
        return { event, Content };
    })
);
---

<!doctype html>
<html lang="en">
	<head>
		<BaseHead title={`Events & Workshops - ${SITE_TITLE}`} description="Academic events, workshops, and conferences organized and participated by Dr. Mohamad Reza Shahabian Alashti" />
		<style>
			.events-container {
				max-width: 64rem;
				margin: 0 auto;
				padding: 2rem 1rem;
			}
			.back-link {
				display: inline-flex;
				align-items: center;
				gap: 0.5rem;
				margin-bottom: 2rem;
				color: var(--accent);
				text-decoration: none;
				font-weight: 600;
				font-size: 1rem;
			}
			.back-link:hover {
				opacity: 0.8;
			}
			.event-section {
				margin-bottom: 4rem;
				padding: 2rem;
				background: white;
				border-radius: 16px;
				box-shadow: 0 2px 8px rgba(15, 23, 42, 0.08);
				scroll-margin-top: 100px;
			}
			.event-header {
				margin-bottom: 2rem;
				padding-bottom: 1.5rem;
				border-bottom: 2px solid rgba(var(--gray-light), 1);
			}
			.event-header h2 {
				margin: 0 0 1rem 0;
				color: rgb(var(--black));
				font-size: 2rem;
				line-height: 1.3;
			}
			.event-meta {
				display: flex;
				flex-wrap: wrap;
				gap: 1.5rem;
				margin: 1.5rem 0;
				padding: 1.25rem;
				background: rgba(var(--accent), 0.05);
				border-radius: 12px;
			}
			.meta-item {
				display: flex;
				align-items: center;
				gap: 0.5rem;
				color: rgb(var(--gray-dark));
				font-weight: 600;
			}
			.event-description {
				font-size: 1.15rem;
				color: rgb(var(--gray-dark));
				margin: 1rem 0;
				line-height: 1.7;
			}
			.event-content {
				margin-top: 2rem;
				font-size: 1.05rem;
				line-height: 1.8;
			}
			.event-content h2 {
				margin-top: 2rem;
				margin-bottom: 1rem;
				color: var(--accent);
				font-size: 1.5rem;
			}
			.event-content h3 {
				margin-top: 1.5rem;
				margin-bottom: 0.75rem;
				color: rgb(var(--gray-dark));
			}
			.event-content ul, .event-content ol {
				margin: 1rem 0;
				padding-left: 1.5rem;
			}
			.event-content li {
				margin: 0.5rem 0;
			}
			.event-content a {
				color: var(--accent);
				text-decoration: underline;
			}
			.event-content strong {
				color: var(--accent);
			}
			.event-content hr {
				margin: 2rem 0;
				border: none;
				border-top: 1px solid rgba(var(--gray-light), 1);
			}
			.registration-link {
				display: inline-flex;
				align-items: center;
				gap: 0.5rem;
				padding: 0.7rem 1.3rem;
				background: var(--accent);
				color: white;
				text-decoration: none;
				border-radius: 8px;
				font-weight: 600;
				transition: opacity 0.2s;
				font-size: 0.95rem;
				margin-top: 1rem;
			}
			.registration-link:hover {
				opacity: 0.85;
			}
		</style>
	</head>
	<body>
		<Header />
		<main>
			<div class="events-container">
				<a href="/#events" class="back-link">
					<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
						<polyline points="15 18 9 12 15 6"></polyline>
					</svg>
					Back to Home
				</a>

				<h1 style="margin-bottom: 3rem; font-size: 2.5rem;">Events & Workshops</h1>

				{renderedEvents.map(({ event, Content }) => (
					<article class="event-section" id={event.id}>
						<div class="event-header">
							<h2>{event.data.title}</h2>
							
							<div class="event-meta">
								<div class="meta-item">
									<svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
										<path d="M19 4h-1V2h-2v2H8V2H6v2H5c-1.11 0-1.99.9-1.99 2L3 20c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 16H5V9h14v11zM7 11h5v5H7z"/>
									</svg>
									{event.data.date}
								</div>
								{event.data.location && (
									<div class="meta-item">
										<svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
											<path d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z"/>
										</svg>
										{event.data.location}
									</div>
								)}
							</div>

							<p class="event-description">
								{event.data.description}
							</p>

							{event.data.registrationUrl && (
								<a href={event.data.registrationUrl} target="_blank" rel="noopener noreferrer" class="registration-link">
									<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
										<path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path>
										<polyline points="15 3 21 3 21 9"></polyline>
										<line x1="10" y1="14" x2="21" y2="3"></line>
									</svg>
									Register / More Info
								</a>
							)}
						</div>

						<div class="event-content">
							<Content />
						</div>
					</article>
				))}
			</div>
		</main>

		<script>
			// Scroll to section if hash is present
			if (window.location.hash) {
				setTimeout(() => {
					const element = document.querySelector(window.location.hash);
					if (element) {
						element.scrollIntoView({ behavior: 'smooth', block: 'start' });
					}
				}, 100);
			}
		</script>

		<Footer />
	</body>
</html>
