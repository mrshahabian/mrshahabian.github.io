---
import { getCollection, render } from 'astro:content';
import BaseHead from '../components/BaseHead.astro';
import Header from '../components/Header.astro';
import Footer from '../components/Footer.astro';
import { SITE_TITLE } from '../consts';

const projects = (await getCollection('projects')).sort((a, b) => {
    const yearA = a.data.year || '0';
    const yearB = b.data.year || '0';
    return yearB.localeCompare(yearA);
});

// Render all projects
const renderedProjects = await Promise.all(
    projects.map(async (project) => {
        const { Content } = await render(project);
        return { project, Content };
    })
);
---

<!doctype html>
<html lang="en">
	<head>
		<BaseHead title={`Projects - ${SITE_TITLE}`} description="Research projects and technical work" />
		<style>
			.projects-container {
				max-width: 64rem;
				margin: 0 auto;
				padding: 2rem 1rem;
			}
			.back-link {
				display: inline-flex;
				align-items: center;
				gap: 0.5rem;
				margin-bottom: 2rem;
				color: var(--accent);
				text-decoration: none;
				font-weight: 600;
				font-size: 1rem;
			}
			.back-link:hover {
				opacity: 0.8;
			}
			.project-section {
				margin-bottom: 4rem;
				padding: 2rem;
				background: white;
				border-radius: 16px;
				box-shadow: 0 2px 8px rgba(15, 23, 42, 0.08);
				scroll-margin-top: 100px;
			}
			.project-header {
				margin-bottom: 2rem;
				padding-bottom: 1.5rem;
				border-bottom: 2px solid rgba(var(--gray-light), 1);
			}
			.project-header h2 {
				margin: 0 0 0.5rem 0;
				color: rgb(var(--black));
				font-size: 2rem;
			}
			.project-meta {
				display: flex;
				flex-wrap: wrap;
				gap: 1rem;
				margin: 1rem 0;
				color: rgb(var(--gray));
				font-size: 0.95rem;
			}
			.project-description {
				font-size: 1.15rem;
				color: rgb(var(--gray-dark));
				margin: 1rem 0;
				line-height: 1.7;
			}
			.tags {
				display: flex;
				flex-wrap: wrap;
				gap: 0.5rem;
				margin: 1.5rem 0;
			}
			.tag {
				background: rgba(var(--accent), 0.1);
				color: var(--accent);
				padding: 0.5rem 1rem;
				border-radius: 8px;
				font-size: 0.9rem;
				font-weight: 600;
			}
			.links {
				display: flex;
				flex-wrap: wrap;
				gap: 1rem;
				margin: 2rem 0;
				padding: 1.5rem;
				background: rgba(var(--gray-light), 0.4);
				border-radius: 12px;
			}
			.links a {
				display: inline-flex;
				align-items: center;
				gap: 0.5rem;
				padding: 0.7rem 1.3rem;
				background: var(--accent);
				color: white;
				text-decoration: none;
				border-radius: 8px;
				font-weight: 600;
				transition: opacity 0.2s;
				font-size: 0.95rem;
			}
			.links a:hover {
				opacity: 0.85;
			}
			.project-content {
				margin-top: 2rem;
				font-size: 1.05rem;
				line-height: 1.8;
			}
			.project-content h2 {
				margin-top: 2rem;
				margin-bottom: 1rem;
				color: var(--accent);
				font-size: 1.5rem;
			}
			.project-content h3 {
				margin-top: 1.5rem;
				margin-bottom: 0.75rem;
				color: rgb(var(--gray-dark));
			}
			.project-content ul, .project-content ol {
				margin: 1rem 0;
				padding-left: 1.5rem;
			}
			.project-content li {
				margin: 0.5rem 0;
			}
			.project-content a {
				color: var(--accent);
				text-decoration: underline;
			}
			.project-content code {
				background: rgba(var(--gray-light), 0.6);
				padding: 0.2rem 0.5rem;
				border-radius: 4px;
				font-size: 0.9em;
			}
			.project-content pre {
				background: rgb(var(--gray-dark));
				color: white;
				padding: 1.5rem;
				border-radius: 8px;
				overflow-x: auto;
				margin: 1.5rem 0;
			}
			.project-content pre code {
				background: none;
				padding: 0;
			}
			.project-content img {
				max-width: 100%;
				height: auto;
				border-radius: 12px;
				margin: 2rem 0;
				box-shadow: 0 4px 12px rgba(0,0,0,0.1);
			}
			.project-content blockquote {
				border-left: 4px solid var(--accent);
				padding-left: 1.5rem;
				margin: 1.5rem 0;
				color: rgb(var(--gray));
				font-style: italic;
			}
		</style>
	</head>
	<body>
		<Header />
		<main>
			<div class="projects-container">
				<a href="/#projects" class="back-link">
					<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
						<polyline points="15 18 9 12 15 6"></polyline>
					</svg>
					Back to Home
				</a>

				<h1 style="margin-bottom: 3rem; font-size: 2.5rem;">All Projects</h1>

				{renderedProjects.map(({ project, Content }) => (
					<article class="project-section" id={project.id}>
						<div class="project-header">
							<h2>{project.data.title}</h2>
							
							<div class="project-meta">
								{project.data.year && <span>ðŸ“… {project.data.year}</span>}
								{project.data.role && <span>ðŸ‘¤ {project.data.role}</span>}
							</div>

							<p class="project-description">
								{project.data.description}
							</p>

							{project.data.tags && project.data.tags.length > 0 && (
								<div class="tags">
									{project.data.tags.map(tag => (
										<span class="tag">{tag}</span>
									))}
								</div>
							)}

							{project.data.links && (
								<div class="links">
									{project.data.links.github && (
										<a href={project.data.links.github} target="_blank" rel="noopener noreferrer">
											<svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
												<path d="M12 0C5.37 0 0 5.37 0 12c0 5.31 3.435 9.795 8.205 11.385.6.105.825-.255.825-.57 0-.285-.015-1.23-.015-2.235-3.015.555-3.795-.735-4.035-1.41-.135-.345-.72-1.41-1.23-1.695-.42-.225-1.02-.78-.015-.795.945-.015 1.62.87 1.845 1.23 1.08 1.815 2.805 1.305 3.495.99.105-.78.42-1.305.765-1.605-2.67-.3-5.46-1.335-5.46-5.925 0-1.305.465-2.385 1.23-3.225-.12-.3-.54-1.53.12-3.18 0 0 1.005-.315 3.3 1.23.96-.27 1.98-.405 3-.405s2.04.135 3 .405c2.295-1.56 3.3-1.23 3.3-1.23.66 1.65.24 2.88.12 3.18.765.84 1.23 1.905 1.23 3.225 0 4.605-2.805 5.625-5.475 5.925.435.375.81 1.095.81 2.22 0 1.605-.015 2.895-.015 3.3 0 .315.225.69.825.57A12.02 12.02 0 0024 12c0-6.63-5.37-12-12-12z"/>
											</svg>
											GitHub
										</a>
									)}
									{project.data.links.demo && (
										<a href={project.data.links.demo} target="_blank" rel="noopener noreferrer">
											<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
												<path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path>
												<polyline points="15 3 21 3 21 9"></polyline>
												<line x1="10" y1="14" x2="21" y2="3"></line>
											</svg>
											Live Demo
										</a>
									)}
									{project.data.links.paper && (
										<a href={project.data.links.paper} target="_blank" rel="noopener noreferrer">
											<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
												<path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
												<polyline points="14 2 14 8 20 8"></polyline>
											</svg>
											Paper
										</a>
									)}
								</div>
							)}
						</div>

						<div class="project-content">
							<Content />
						</div>
					</article>
				))}
			</div>
		</main>

		<script>
			// Scroll to section if hash is present
			if (window.location.hash) {
				setTimeout(() => {
					const element = document.querySelector(window.location.hash);
					if (element) {
						element.scrollIntoView({ behavior: 'smooth', block: 'start' });
					}
				}, 100);
			}
		</script>

		<Footer />
	</body>
</html>
